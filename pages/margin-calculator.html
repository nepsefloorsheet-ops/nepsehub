<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Margin Calculator | NEPSE Hub</title>
    <link
      rel="shortcut icon"
      href="../img/favicon/NH.png"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="../src/css/global.css" />
    <link rel="stylesheet" href="../src/css/calculators/margin.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@600;700&family=Roboto+Mono:wght@500;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../src/js/auth-guard.js"></script>
  </head>
  <body>
    <div id="layout"></div>

    <main class="active">
      <header class="header">
        <div class="header-items">
          <div class="header-group">
            <div class="header-col">
              <span class="header-col-label">NEPSE Index</span>
              <div id="nepseData" class="flex gap-10 items-baseline">
                <span class="index-value">--</span>
                <div class="flex column">
                  <span class="difference">--</span>
                  <span class="percent-ch">(--)</span>
                </div>
              </div>
            </div>
            <div class="divider-v"></div>
            <span class="pulse-dot" id="headerPulse"></span>
            <div class="turnover-volume">
              <div class="header-col">
                <div class="header-col-item">
                  <span class="header-col-label">Total Turnover</span>
                  <span class="header-col-value turnover">--</span>
                </div>
                <div class="header-col-item">
                  <span class="header-col-label">Total Volume</span>
                  <span class="header-col-value volume">--</span>
                </div>
              </div>
            </div>
          </div>

          <div class="header-group">
            <div class="header-col right">
              <span
                id="currentDate"
                class="header-col-label"
                style="font-size: 0.9rem"
                >---, -- ---</span
              >
              <span
                id="currentTime"
                class="header-col-value"
                style="font-size: 0.9rem"
                >--:--:--</span
              >
            </div>
            <div class="divider-v"></div>
            <div class="header-col items-center">
              <div class="flex items-center gap-8" style="margin-bottom: 2px">
                <span id="market-status" class="market-pill">Checking...</span>
              </div>
              <div class="theme-switcher">
                <button class="theme-btn" data-theme="dark" title="Dark Mode">
                  <i class="fa-solid fa-moon"></i>
                </button>
                <button class="theme-btn" data-theme="light" title="Light Mode">
                  <i class="fa-regular fa-sun"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </header>

      <div class="content">
        <div class="header">
          <div class="header-items">
            <h1 id="page-title">Margin Calculator</h1>
          </div>
        </div>
        <div class="calculator-container">
          <div class="calc-grid">
            <!-- INPUT PANEL -->
            <div class="card">
              <div class="card-header">
                <i class="fas fa-edit"></i>
                <h2>Trade Details</h2>
              </div>

              <div class="form-group">
                <label>Quantity</label>
                <div class="input-wrapper">
                  <i class="fas fa-layer-group"></i>
                  <input type="number" id="units" value="0" min="1" step="1" />
                  <span class="input-suffix">Units</span>
                </div>
              </div>

              <div class="form-group">
                <label>Purchase Price</label>
                <div class="input-wrapper">
                  <i class="fas fa-tag"></i>
                  <input
                    type="number"
                    id="buy-price"
                    value="0"
                    min="1"
                    step="0.01"
                  />
                  <span class="input-suffix">per unit</span>
                </div>
              </div>

              <div class="form-group">
                <label>Selling Price</label>
                <div class="input-wrapper">
                  <i class="fas fa-hand-holding-dollar"></i>
                  <input
                    type="number"
                    id="sell-price"
                    value="0"
                    min="1"
                    step="0.01"
                  />
                  <span class="input-suffix">per unit</span>
                </div>
              </div>

              <div class="form-group">
                <label>Holding Period</label>
                <div class="input-wrapper">
                  <i class="fas fa-calendar-alt"></i>
                  <input
                    type="number"
                    id="holding-days"
                    value="0"
                    min="1"
                    step="1"
                  />
                  <span class="input-suffix">Days</span>
                </div>
              </div>

              <div class="form-group">
                <label>Annual Interest Rate</label>
                <div class="input-wrapper">
                  <i class="fas fa-percent"></i>
                  <input
                    type="number"
                    id="interest-rate"
                    value="0"
                    min="1"
                    max="100"
                    step="0.1"
                  />
                  <span class="input-suffix">%</span>
                </div>
              </div>

              <div class="slab-info container mt-20">
                <table class="slab-table">
                  <thead>
                    <tr>
                      <th>Transaction Amount (Rs.)</th>
                      <th>Rate</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Up to 50,000</td>
                      <td>0.36% (min 10)</td>
                    </tr>
                    <tr>
                      <td>50,001 - 5,00,000</td>
                      <td>0.33%</td>
                    </tr>
                    <tr>
                      <td>5,00,001 - 20,00,000</td>
                      <td>0.31%</td>
                    </tr>
                    <tr>
                      <td>20,00,001 - 1,00,00,000</td>
                      <td>0.27%</td>
                    </tr>
                    <tr>
                      <td>Above 1,00,00,000</td>
                      <td>0.24%</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- RESULT PANEL -->
            <div class="card results-card">
              <div class="card-header">
                <i class="fas fa-chart-pie"></i>
                <h2>Analysis</h2>
              </div>

              <div class="result-row">
                <span class="result-label">Gross Buy Amount</span>
                <span class="result-value" id="gross-buy">Rs. 0.00</span>
              </div>
              <div class="result-row">
                <span class="result-label">Buy Fees (Comm + SEBON + DP)</span>
                <span class="result-value" id="buy-fees">Rs. 0.00</span>
              </div>
              <div
                class="result-row"
                style="
                  background: rgba(37, 99, 235, 0.05);
                  border-radius: 4px;
                  padding: 10px;
                "
              >
                <span
                  class="result-label"
                  style="color: var(--accent-primary); font-weight: 600"
                  >Total Purchase Cost</span
                >
                <span
                  class="result-value"
                  id="total-buy-cost"
                  style="color: var(--accent-primary)"
                  >Rs. 0.00</span
                >
              </div>

              <div class="result-row mt-12">
                <span class="result-label">User Investment (30%)</span>
                <span class="result-value" id="user-investment">Rs. 0.00</span>
              </div>
              <div class="result-row">
                <span class="result-label">Broker Loan (70%)</span>
                <span class="result-value" id="broker-loan">Rs. 0.00</span>
              </div>

              <div class="result-row mt-12">
                <span class="result-label">Accrued Interest</span>
                <span class="result-value" id="accrued-interest">Rs. 0.00</span>
              </div>

              <div class="result-row mt-12">
                <span class="result-label">Gross Sell Amount</span>
                <span class="result-value" id="gross-sell">Rs. 0.00</span>
              </div>
              <div class="result-row">
                <span class="result-label">Sell Fees (Comm + SEBON + DP)</span>
                <span class="result-value" id="sell-fees">Rs. 0.00</span>
              </div>
              <div class="result-row">
                <span class="result-label">Net Receiveable</span>
                <span class="result-value" id="net-sell">Rs. 0.00</span>
              </div>

              <div class="summary-section">
                <div id="status-card" class="main-result profit">
                  <span class="label">Net Settlement Amount</span>
                  <div class="value" id="pnl-value">Rs. 0.00</div>
                  <div class="roi-badge profit" id="roi-value">ROI: 0.00%</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script src="../src/js/utils/cleanup-manager.js?v=2"></script>
    <script src="../src/js/services/api-service.js?v=2"></script>
    <script src="../src/js/layout.js?v=2"></script>
    <script src="../src/js/global.js?v=2"></script>
    <script src="../src/js/calculators/margin.js"></script>
  </body>
</html>
