<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Market Heatmap | NEPSE Hub</title>
    <link rel="shortcut icon" href="../img/favicon/NH.png" type="image/x-icon" />
    <link rel="stylesheet" href="../src/css/global.css" />
    <link rel="stylesheet" href="../src/css/market/heatmap.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;600;700&family=Roboto+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="../src/js/auth-guard.js"></script>
  </head>

  <body>
    <div id="layout"></div>
    <main class="active">
      <header class="header">
        <div class="header-items">
          <div class="header-group">
            <div class="header-col">
              <span class="header-col-label">NEPSE Index</span>
              <div id="nepseData" class="flex gap-10 items-baseline">
                <span class="index-value">--</span>
                <div class="flex column">
                  <span class="difference">--</span>
                  <span class="percent-ch">(--)</span>
                </div>
              </div>
            </div>
            <div class="divider-v"></div>
            <span class="pulse-dot" id="headerPulse"></span>
            <div class="turnover-volume">
              <div class="header-col">
                <div class="header-col-item">
                  <span class="header-col-label">Total Turnover</span>
                  <span class="header-col-value turnover">--</span>
                </div>
                <div class="header-col-item">
                  <span class="header-col-label">Total Volume</span>
                  <span class="header-col-value volume">--</span>
                </div>
              </div>
            </div>
          </div>

          <div class="header-group">
            <div class="header-col right">
              <span
                id="currentDate"
                class="header-col-label"
                style="font-size: 0.9rem"
                >---, -- ---</span
              >
              <span
                id="currentTime"
                class="header-col-value"
                style="font-size: 0.9rem"
                >--:--:--</span
              >
            </div>
            <div class="divider-v"></div>
            <div class="header-col items-center">
              <div class="flex items-center gap-8" style="margin-bottom: 2px">
                <span id="market-status" class="market-pill">Checking...</span>
              </div>
              <div class="theme-switcher">
                <button class="theme-btn" data-theme="dark" title="Dark Mode">
                  <i class="fa-solid fa-moon"></i>
                </button>
                <button class="theme-btn" data-theme="light" title="Light Mode">
                  <i class="fa-regular fa-sun"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </header>

      <div class="heatmap-controls flex space-between items-center gap-20">
        <div class="flex column gap-5">
          <div class="heatmap-tabs flex gap-10">
            <button class="tab-btn active" data-type="turnover">
              Turnover
            </button>
            <button class="tab-btn" data-type="volume">Volume</button>
            <div
              class="divider-vertical"
              style="width: 1px; background: var(--border-color); margin: 0 5px"
            ></div>
            <button
              class="tab-btn mode-btn active"
              data-mode="absolute"
              title="Color by Stock % Change"
            >
              Abs %
            </button>
            <button
              class="tab-btn mode-btn"
              data-mode="relative"
              title="Color by Stock % - Sector Avg %"
            >
              Rel Strength
            </button>
          </div>
          <span
            id="mode-hint"
            class="text-muted"
            style="font-size: 11px; margin-left: 5px"
            >Shows raw price movement</span
          >
        </div>
        <div class="heatmap-filters flex gap-16 items-center">
          <label for="sectorFilter" class="text-secondary">Sector:</label>
          <select id="sectorFilter" class="premium-select">
            <option value="all">All Sectors</option>
          </select>
        </div>
      </div>
      <div class="content" id="heatmap-container-wrapper">
        <div
          id="sector-summary"
          class="hidden flex gap-20 items-center mb-10"
          style="
            background: var(--surface-bg);
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            font-family: &quot;Roboto Mono&quot;, monospace;
            font-size: 13px;
          "
        >
          <!-- Content injected by JS -->
        </div>
        <div id="heatmap-container"></div>
        <div
          id="heatmap-legend"
          class="flex gap-20 items-center justify-center column"
        >
          <div
            id="legend-title"
            class="text-muted"
            style="font-size: 12px; margin-bottom: 5px"
          >
            Color: % Price Change
          </div>
          <div class="flex gap-20 items-center justify-center">
            <div class="legend-item">
              <span class="legend-color strong-pos"></span> Strong +
            </div>
            <div class="legend-item">
              <span class="legend-color mild-pos"></span> Mild +
            </div>
            <div class="legend-item">
              <span class="legend-color neutral"></span> Neutral
            </div>
            <div class="legend-item">
              <span class="legend-color mild-neg"></span> Mild -
            </div>
            <div class="legend-item">
              <span class="legend-color strong-neg"></span> Strong -
            </div>
          </div>
        </div>
      </div>
      <div id="heatmap-tooltip" class="heatmap-tooltip hidden"></div>
    </main>
    <script src="../src/js/utils/cleanup-manager.js?v=2"></script>
    <script src="../src/js/utils/error-handler.js?v=2"></script>
    <script src="../src/js/services/api-service.js?v=2"></script>
    <script defer src="../src/js/layout.js?v=2"></script>
    <script defer src="../src/js/global.js?v=2"></script>
    <script defer src="../src/js/market/heatmap.js?v=2"></script>
  </body>
</html>
