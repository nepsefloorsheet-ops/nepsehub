<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Broker Summary | NEPSE Hub</title>
    <link rel="shortcut icon" href="../img/favicon/NH.png" type="image/x-icon" />
    <link rel="stylesheet" href="../src/css/global.css" />
    <link rel="stylesheet" href="../src/css/utils/status.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;600;700&family=Roboto+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  </head>
  <body>
    <div id="layout"></div>

    <main class="active" role="main">
      <header class="header">
        <div class="header-items">
          <div class="header-group">
            <div class="header-col">
              <span class="header-col-label">NEPSE Index</span>
              <div id="nepseData" class="flex gap-10 items-baseline">
                <span class="index-value">--</span>
                <div class="flex column">
                  <span class="difference">--</span>
                  <span class="percent-ch">(--)</span>
                </div>
              </div>
            </div>
            <div class="divider-v"></div>
            <span class="pulse-dot" id="headerPulse"></span>
            <div class="turnover-volume">
              <div class="header-col">
                <div class="header-col-item">
                  <span class="header-col-label">Total Turnover</span>
                  <span class="header-col-value turnover">--</span>
                </div>
                <div class="header-col-item">
                  <span class="header-col-label">Total Volume</span>
                  <span class="header-col-value volume">--</span>
                </div>
              </div>
            </div>
          </div>

          <div class="header-group">
            <div class="header-col right">
              <span
                id="currentDate"
                class="header-col-label"
                style="font-size: 0.9rem"
                >---, -- ---</span
              >
              <span
                id="currentTime"
                class="header-col-value"
                style="font-size: 0.9rem"
                >--:--:--</span
              >
            </div>
            <div class="divider-v"></div>
            <div class="header-col items-center">
              <div class="flex items-center gap-8" style="margin-bottom: 2px">
                <span id="market-status" class="market-pill">Checking...</span>
              </div>
              <div class="theme-switcher">
                <button class="theme-btn" data-theme="dark" title="Dark Mode">
                  <i class="fa-solid fa-moon"></i>
                </button>
                <button class="theme-btn" data-theme="light" title="Light Mode">
                  <i class="fa-regular fa-sun"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </header>

      <div class="broker-snapshot-container">
        <!-- Summary Cards -->
        <div class="summary-cards-container">
          <div class="summary-card gold" id="card-market-leader">
            <div class="summary-card-icon"><i class="fas fa-crown"></i></div>
            <div class="summary-card-content">
              <span class="summary-card-label">Market Leader</span>
              <span class="summary-card-value" id="leader-id">--</span>
              <span class="summary-card-sub" id="leader-turnover"
                >Turnover: --</span
              >
            </div>
          </div>
          <div class="summary-card green" id="card-top-accumulator">
            <div class="summary-card-icon"><i class="fas fa-bullseye"></i></div>
            <div class="summary-card-content">
              <span class="summary-card-label">Top Accumulation</span>
              <span class="summary-card-value" id="accumulator-id">--</span>
              <span class="summary-card-sub" id="accumulator-net">Net: --</span>
            </div>
          </div>
          <div class="summary-card red" id="card-top-distributor">
            <div class="summary-card-icon">
              <i class="fas fa-bear-market"></i>
            </div>
            <div class="summary-card-content">
              <span class="summary-card-label">Top Distribution</span>
              <span class="summary-card-value" id="distributor-id">--</span>
              <span class="summary-card-sub" id="distributor-net">Net: --</span>
            </div>
          </div>
        </div>

        <!-- Net Flow Chart -->
        <div class="chart-section mb-30">
          <div class="chart-container-premium">
            <h3 class="chart-title">
              <i class="fas fa-chart-bar"></i> Top Accumulation vs Distribution
              (Net Flow)
            </h3>
            <div style="height: 350px; position: relative">
              <canvas id="netFlowChart"></canvas>
            </div>
          </div>
        </div>

        <div class="card-header flex space-between items-center mb-20">
          <div>
            <h1
              class="status-title"
              style="text-align: left; margin: 0; font-size: 1.5rem"
            >
              Broker Summary
            </h1>
          </div>
          <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input
              type="text"
              id="broker-search"
              placeholder="Search Broker ID (e.g. 58)..."
              autocomplete="off"
            />
          </div>
        </div>

        <div class="table-wrapper">
          <table id="broker-table">
            <thead>
              <tr>
                <th class="sortable left" data-sort="buyer">
                  Broker <i class="fas fa-sort"></i>
                </th>
                <th class="sortable right" data-sort="buy_amount">
                  Buy Amount <i class="fas fa-sort"></i>
                </th>
                <th class="sortable right" data-sort="sell_amount">
                  Sell Amount <i class="fas fa-sort"></i>
                </th>
                <th class="sortable right" data-sort="total_turnover">
                  Total Turnover <i class="fas fa-sort"></i>
                </th>
                <th class="sortable right" data-sort="market_share">
                  Mkt Share % <i class="fas fa-sort"></i>
                </th>
                <th class="sortable right" data-sort="net_amount">
                  Net Amount <i class="fas fa-sort"></i>
                </th>
                <th class="sortable right" data-sort="diff_pct">
                  Diff % (B vs. S) <i class="fas fa-sort"></i>
                </th>
                <th class="sortable right" data-sort="net_matching">
                  Net Matching <i class="fas fa-sort"></i>
                </th>
              </tr>
            </thead>
            <tbody id="broker-body">
              <tr>
                <td colspan="8" class="empty-watchlist">
                  <div
                    class="shimmer"
                    style="height: 300px; border-radius: 8px"
                  ></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>

    <script src="../src/js/layout.js"></script>
    <script src="../src/js/utils/status.js"></script>
    <script src="../src/js/utils/cleanup-manager.js"></script>
    <script src="../src/js/utils/error-handler.js"></script>
    <script src="../src/js/services/api-service.js"></script>
    <script src="../src/js/global.js"></script>
    <script src="../src/js/services/auth-service.js"></script>
    <script src="../src/js/market/broker-summary.js"></script>
  </body>
</html>
